{% extends "template.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block content %}
  <div class="govuk-width-container ">
    <main class="govuk-main-wrapper">

      <h1 class="govuk-heading-l" id="heading">Log Out</h1>

      <div id="info">
        <p>
          Attempting to log out automatically.
        </p>
        <p>
          If this doesn't to work after a few moments you can 
          <a href="{{endSessionUrl}}">log out manually</a>.
        </p>
      </div>

      {{ govukButton({
        text: "Continue",
        href: "/"
      }) }}

    </div>
  </main>
</div>
{% endblock %}

{% block bodyEnd %}
  {{ super() }}
  <script>
    (function(endSessionUrl){

      // This script replicates the Azure B2C logout process

      document.getElementById("heading").innerText = "Logging Out";
      var iframe = document.createElement("iframe");
      iframe.setAttribute("style", "display:none;width:1px;height:1px");
      iframe.name = "logout";
      iframe.src = endSessionUrl;
  
      iframe.addEventListener('load', () => {
        console.log("logout iframe loaded");
        document.getElementById("heading").innerText = "Logged out";
      });

      /*
      window.addEventListener("message", (event) => {
        if(event.data === "logout"){
          console.log("logout message received");
          document.getElementById("heading").innerText = "Logged out";
        }
      }, false);
      */

      document.body.appendChild(iframe);
    })('{{endSessionUrl}}');
  </script>
{% endblock %}